#include "Player.hpp"
#include <cstdio>
#include<vector>

using namespace std;

Player::Player(float x, float y, float width, float height, int id, int state, float speedX, float speedY, float movementSpeed_, int direction_)
    : Entity(x, y, width, height, id, state),
    speed{ speedX, speedY },
    movementSpeed(movementSpeed_),
    isJumping(false),
    onGround(false),
    colliding(false),
    immunity(false),
    time(3.0f),
    frameCounter(0),
    currentFrame(0),
    timer(0),
    frameSpeed(0.15f),
    direction(direction_){

    //textures
    lMarioR1 = LoadTexture("resources/mario1.png");
    lMarioR2 = LoadTexture("resources/mario2.png");
    lMarioR3 = LoadTexture("resources/mario3.png");
    lMarioR4 = LoadTexture("resources/mario4.png");

    lMarioL1 = LoadTexture("resources/Lmario1.png");
    lMarioL2 = LoadTexture("resources/Lmario2.png");
    lMarioL3 = LoadTexture("resources/Lmario3.png");
    lMarioL4 = LoadTexture("resources/Lmario4.png");

    jumplMarioL = LoadTexture("resources/Lmario5.png");
    jumplMarioR = LoadTexture("resources/mario5.png");

    bMarioR1 = LoadTexture("resources/bmario1.png");
    bMarioR2 = LoadTexture("resources/bmario2.png");
    bMarioR3 = LoadTexture("resources/bmario3.png");
    bMarioR4 = LoadTexture("resources/bmario4.png");

    bMarioL1 = LoadTexture("resources/Lbmario1.png");
    bMarioL2 = LoadTexture("resources/Lbmario2.png");
    bMarioL3 = LoadTexture("resources/Lbmario3.png");
    bMarioL4 = LoadTexture("resources/Lbmario4.png");

    jumpbMarioL = LoadTexture("resources/Lbmario5.png");
    jumpbMarioR = LoadTexture("resources/bmario5.png");

    //sounds
    jumpSound = LoadSound("resources/audio/jumpSmall.wav");
    //SetSoundVolume(jumpSound, 1.0f); // Set proper volume
    jumpGoombaS = LoadSound("resources/audio/smb_stomp.wav");
}

Player::~Player() {

    UnloadTexture(lMarioR1);
    UnloadTexture(lMarioR2);
    UnloadTexture(lMarioR3);
    UnloadTexture(lMarioR4);

    UnloadTexture(lMarioL1);
    UnloadTexture(lMarioL2);
    UnloadTexture(lMarioL3);
    UnloadTexture(lMarioL4);

    UnloadTexture(bMarioR1);
    UnloadTexture(bMarioR2);
    UnloadTexture(bMarioR3);
    UnloadTexture(bMarioR4);

    UnloadTexture(bMarioL1);
    UnloadTexture(bMarioL2);
    UnloadTexture(bMarioL3);
    UnloadTexture(bMarioL4);

    UnloadSound(jumpSound);
    UnloadSound(jumpGoombaS);
}

void Player::draw() {

    //frameCounter++;

    /*Rectangle rec = frameRec;

    int frameWidth = littleMarioL.width / 4;
    int frameHeigh = littleMarioL.height;

    rec = { 0,0,(float)frameWidth, (float)frameHeigh };

    float delta = GetFrameTime();
    timer += delta;*/


    //    frameRec.x = (float)currentFrame * frameWidth;
    //}



    //if (onGround) {
    //    if (frameCounter >= (60 / frameSpeed)) {
    //        frameCounter = 0;
    //        currentFrame++;
    //        if (currentFrame > 3) currentFrame = 0;
    //    }

    //    frameRec.x = (float)currentFrame * frameRec.width;
    //}

    //Texture2D currentTexture;

    //if (direction == 0) {
    //    // Dirección derecha
    //    if (onGround) {
    //        // Mario grande caminando en el suelo, derecha
    //        currentTexture = bMarioWalkRight;
    //        DrawTextureRec(currentTexture, frameRec, { hitbox.x, hitbox.y-16 }, WHITE);
    //    }
    //    else {
    //        // Mario grande saltando, derecha
    //        currentTexture = jumpMarioR;
    //        DrawTexture(currentTexture, hitbox.x, hitbox.y-16, WHITE);
    //    }
    //}
    //else {
    //    // Dirección izquierda
    //    if (onGround) {
    //        // Mario grande caminando en el suelo, izquierda
    //        currentTexture = bMarioWalkLeft;
    //        DrawTextureRec(currentTexture, frameRec, { hitbox.x, hitbox.y-16 }, WHITE);
    //    }
    //    else {
    //        // Mario grande saltando, izquierda
    //        currentTexture = jumpMarioL;
    //        DrawTexture(currentTexture, hitbox.x, hitbox.y-16, WHITE);
    //    }
    //}

    timer += GetFrameTime();  // << AÑADIR ESTO

    if (timer >= frameSpeed) {
        timer = 0.0f;
        currentFrame++;
        if (currentFrame > 3) currentFrame = 0;
    }
    if (state == 1) {
        if (direction == 1) {

            if (immunity) {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumplMarioR, hitbox.x, hitbox.y, WHITE);
                    }
                    else {

                        DrawTexture(jumplMarioR, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 0) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 1) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 2) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 3) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
            else {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumplMarioR, hitbox.x, hitbox.y, WHITE);
                    }
                    else {

                        DrawTexture(jumplMarioR, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 0) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 1) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 2) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 3) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
        }
        else {

            if (immunity) {

                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumplMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(jumplMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 0) {

                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 1) {

                        DrawTexture(lMarioL2, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 2) {

                        DrawTexture(lMarioL3, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 3) {

                        DrawTexture(lMarioL4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
            else {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumplMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(jumplMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 0) {

                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 1) {

                        DrawTexture(lMarioL2, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 2) {

                        DrawTexture(lMarioL3, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 3) {

                        DrawTexture(lMarioL4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
        }
    }
    else if (state == 2) {
        if (direction == 1) {

            if (immunity) {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y-16, WHITE);
                    }
                    else {

                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 0) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR1, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR1, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 1) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR2, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR2, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 2) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR3, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR3, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 3) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR4, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR4, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
            }
            else {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y-16, WHITE);
                    }
                    else {

                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 0) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR1, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR1, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 1) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR2, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR2, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 2) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR3, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR3, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else if (currentFrame == 3) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioR4, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(bMarioR4, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
            }
        }
        else {

            if (immunity) {

                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioL1, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 0) {

                        DrawTexture(bMarioL1, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 1) {

                        DrawTexture(bMarioL2, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 2) {

                        DrawTexture(bMarioL3, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 3) {

                        DrawTexture(bMarioL4, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
            }
            else {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else {

                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
                else {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(bMarioL1, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 0) {

                        DrawTexture(bMarioL1, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 1) {

                        DrawTexture(bMarioL2, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 2) {

                        DrawTexture(bMarioL3, hitbox.x, hitbox.y-16, WHITE);

                    }
                    else if (currentFrame == 3) {

                        DrawTexture(bMarioL4, hitbox.x, hitbox.y-16, WHITE);

                    }
                }
            }
        }
    }
    else if (state == 3) {
        if (direction == 1) {

            if (immunity) {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y, WHITE);
                    }
                    else {

                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 0) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 1) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 2) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 3) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
            else {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y, WHITE);
                    }
                    else {

                        DrawTexture(jumpbMarioR, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 0) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR1, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 1) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR2, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 2) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR3, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else if (currentFrame == 3) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(lMarioR4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
        }
        else {

            if (immunity) {

                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 0) {

                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 1) {

                        DrawTexture(lMarioL2, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 2) {

                        DrawTexture(lMarioL3, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 3) {

                        DrawTexture(lMarioL4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
            else {
                if (isJumping == true) {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                    else {

                        DrawTexture(jumpbMarioL, hitbox.x, hitbox.y, WHITE);

                    }
                }
                else {
                    //to show is immune mario will blink
                    if (((int)(GetTime() * 10) % 2) == 0) {

                        printf("----------------------parpadeando------------------");
                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 0) {

                        DrawTexture(lMarioL1, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 1) {

                        DrawTexture(lMarioL2, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 2) {

                        DrawTexture(lMarioL3, hitbox.x, hitbox.y, WHITE);

                    }
                    else if (currentFrame == 3) {

                        DrawTexture(lMarioL4, hitbox.x, hitbox.y, WHITE);

                    }
                }
            }
        }
    }
 }


void Player::jump(float jumpForce) {
    if (!isJumping || !colliding) {
        speed.y = -jumpForce;
        isJumping = true;
    }

    //InitAudioDevice();
    if (!IsSoundPlaying(jumpSound) && !IsSoundPlaying(jumpGoombaS)) {

        PlaySound(jumpSound);
    }

}

float Player::getTime() {
    return time;
}

void Player::changeDirection() {

    if (direction == 1) { 
        
        direction = 0; 
    }
    else if (direction == 0) {

        direction = 1;
    }
}

void Player::applyGravity(float gravity) {

    //printf("Mario position: x->%f / y->%f\n", hitbox.x, hitbox.y);

    //Aplicar gravedad a MArio
    speed.y += gravity;
    hitbox.y += speed.y;
}
void Player::move(int direction) {


    if (direction == 1) {
        hitbox.x += movementSpeed;
    }
    else {
        hitbox.x -= movementSpeed;
    }
}

void Player::immunityVoid() {
    if (immunity) {
        time -= GetFrameTime();
        if (time <= 0) {
            immunity = false;
            time = 3;
        }
    }
}

void Player::colisionsPlayer(vector<Entity*>& e) {

    for (auto it = e.begin(); it != e.end(); ) {
        Entity* ent = *it;

        // Colisiones con bloques (id == 2)
        if (ent->id == 2 && CheckCollisionRecs(hitbox, ent->getHitbox())) {
            printf("colision con bloque\n");

            if (collidingBottom(ent)) {
                speed.y = 0;
                hitbox.y = ent->getHitbox().y - hitbox.height;
                isJumping = false;
                onGround = true;
            }

            if (collidingAbove(ent)) {
                hitbox.y = ent->getHitbox().y + ent->getHitbox().height;
                speed.y = 1.0f;
            }

            if (CheckCollisionPointRec(left, ent->getHitbox())) {
                hitbox.x = ent->getHitbox().x + ent->getHitbox().width;
            }

            if (CheckCollisionPointRec(right, ent->getHitbox())) {
                hitbox.x = ent->getHitbox().x - hitbox.width;
            }

            colliding = true;

            ++it;
            continue;
        }
        else {

            colliding = false;
            onGround = false;
        }

        // Colisiones con Goomba (id == 1)
        if (CheckCollisionRecs(hitbox, ent->getHitbox()) && !immunity && ent->id == 1) {
            if (CheckCollisionPointRec(bottom, ent->getHitbox()) && ent->state == 1) {
                printf("COLLISION GOOMBA CON LOS PIES\n");

                PlaySound(jumpGoombaS);

                ent->state = 0;

                jump(8.0f);

                delete ent;          // liberar memoria
                it = e.erase(it);    // borrar del vector y continuar
                continue;
            }
            else {
                printf("COLISION CON GOOMBA\n");

                state--;
                if (state == 0) {
                    // Mario muere
                }
                else {
                    immunity = true;
                }
            }
        }
        else {

            colliding = false;
        }

        ++it;
    }
    
}
